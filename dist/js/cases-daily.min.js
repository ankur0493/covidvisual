/*!
 * Covid Visual v0.0.1 (https://www.covidvisual.in)
 * Copyright 2020 Ankur Gupta
 * Licensed under MIT
 */

"use strict";var margin={top:20,right:40,bottom:30,left:50},height=325,width=650,dates=new Array,plotChart=function(u,t){var n=d3.select(t).append("svg").attr("viewBox",[0,0,width,height]).style("overflow","visible"),f=d3.scaleUtc().domain(d3.extent(u,function(t){return t.date})).range([margin.left,width-margin.right]),m=d3.scaleLinear().domain([0,d3.max(u,function(t){return t.total_confirmed})]).nice().range([height-margin.bottom,margin.top]);n.append("g").call(function(t){return t.attr("transform","translate(0,".concat(height-margin.bottom,")")).call(d3.axisBottom(f).ticks(width/80).tickSizeOuter(0))}),n.append("g").call(function(t){return t.attr("transform","translate(".concat(margin.left,",0)")).call(d3.axisLeft(m).ticks(null,"s")).call(function(t){return t.select(".domain").remove()}).call(function(t){return t.select(".tick:last-of-type text").clone().attr("x",3).attr("text-anchor","start").attr("font-weight","bold")})});var e=d3.line().defined(function(t){return!isNaN(t.total_confirmed)}).x(function(t){return f(t.date)}).y(function(t){return m(t.total_confirmed)}),a=n.append("path").datum(u).attr("fill","none").attr("stroke","steelblue").attr("stroke-width",1.5).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("d",e);n.call(function(l,t){"ontouchstart"in document?l.style("-webkit-tap-highlight-color","transparent").on("touchmove",n).on("mouseenter",e).on("mouseleave",a):l.on("mousemove",n).on("mouseenter",e).on("mouseleave",a);var d=l.append("g").attr("display","none").style("font","10px sans-serif"),s=d.selectAll("path").data([null]).join("path").attr("fill","white").attr("stroke","black");function n(){d3.event.preventDefault();m.invert(d3.event.layerY);var t=f.invert(d3.mouse(l.node())[0]),n=d3.bisector(function(t){return t.date}).left(u,t,1),e=n-1,a=t-u[e].date>u[n].date-t?n:e,r=u[a];d.attr("transform","translate(".concat(f(r.date),",").concat(m(r.total_confirmed),")"));var o="".concat(r.date.toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric"}),"\n  ").concat(r.total_confirmed),i=d.selectAll("text").data([null]).join("text").call(function(t){return t.selectAll("tspan").data((o+"").split(/\n/)).join("tspan").attr("x",0).attr("y",function(t,n){return"".concat(1.1*n,"em")}).style("font-weight",function(t,n){return n?null:"bold"}).text(function(t){return t})}),c=i.node().getBBox();i.attr("transform","translate(".concat(-c.width/2,",").concat(15-c.y,")")),s.attr("d","M".concat(-c.width/2-10,",5H-5l5,-5l5,5H").concat(c.width/2+10,"v").concat(c.height+20,"h-").concat(c.width+20,"z"))}function e(){d.attr("display",null)}function a(){d.attr("display","none")}},a)};d3.json("../data/national_confirmed_cases.json").then(function(t){return t.filter(function(t){return t.include_in_chart})}).then(function(t){return d3.map(t,function(t){return d3.timeParse("%Y-%m-%dT%H:%M:%S.%L%Z")(t.record_time).setHours(0,0,0,0)})}).then(function(e){var t=e.values().map(function(t,n){return{date:d3.timeParse("%Y-%m-%dT%H:%M:%S.%L%Z")(t.record_time),total_confirmed:t.total_confirmed_cases}});plotChart(t,"#covid-19-cases");var n=e.values().slice(1).map(function(t,n){return{date:d3.timeParse("%Y-%m-%dT%H:%M:%S.%L%Z")(t.record_time),total_confirmed:t.total_confirmed_cases-e.values()[n].total_confirmed_cases}});plotChart(n,"#covid-19-cases-daily")});