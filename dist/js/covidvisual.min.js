/*!
 * Covid Visual v0.0.1 (https://www.covidvisual.in)
 * Copyright 2020 Ankur Gupta
 * Licensed under MIT
 */

"use strict";!function(a){a("#sidebarToggle, #sidebarToggleTop").on("click",function(t){a("body").toggleClass("sidebar-toggled"),a(".sidebar").toggleClass("toggled"),a(".sidebar").hasClass("toggled")&&a(".sidebar .collapse").collapse("hide")}),a(window).resize(function(){a(window).width()<768&&a(".sidebar .collapse").collapse("hide")}),a("body.fixed-nav .sidebar").on("mousewheel DOMMouseScroll wheel",function(t){if(768<a(window).width()){var e=t.originalEvent,n=e.wheelDelta||-e.detail;this.scrollTop+=30*(n<0?1:-1),t.preventDefault()}}),a(document).on("scroll",function(){100<a(this).scrollTop()?a(".scroll-to-top").fadeIn():a(".scroll-to-top").fadeOut()}),a(document).on("click","a.scroll-to-top",function(t){var e=a(this);a("html, body").stop().animate({scrollTop:a(e.attr("href")).offset().top},1e3,"easeInOutExpo"),t.preventDefault()})}(jQuery);var margin={top:20,right:40,bottom:30,left:50},height=325,width=650,timeParse=d3.timeParse("%Y-%m-%dT%H:%M:%S.%L%Z"),plotChart=function(u,t,f){var e=d3.select(t).append("svg").attr("viewBox",[0,0,width,height]).style("overflow","visible"),n=e.node().getBBox(),m=d3.scaleUtc().domain(d3.extent(u,function(t){return t.date})).range([n.x+margin.left,n.x+width-margin.right]),h=d3.scaleLinear().domain([0,d3.max(u,function(t){return t[f]})]).nice().range([height-margin.bottom,margin.top]);e.append("g").call(function(t){return t.attr("transform","translate(0,".concat(height-margin.bottom,")")).call(d3.axisBottom(m).ticks(width/80).tickSizeOuter(0))}),e.append("g").call(function(t){return t.attr("transform","translate(".concat(margin.left,",0)")).call(d3.axisLeft(h).ticks(null,"s")).call(function(t){return t.select(".domain").remove()}).call(function(t){return t.select(".tick:last-of-type text").clone().attr("x",3).attr("text-anchor","start").attr("font-weight","bold")})});var a=d3.line().defined(function(t){return!isNaN(t[f])}).x(function(t){return m(t.date)}).y(function(t){return h(t[f])}),o=e.append("path").datum(u).attr("fill","none").attr("stroke","steelblue").attr("stroke-width",1.5).attr("stroke-linejoin","round").attr("stroke-linecap","round").attr("d",a);e.call(function(c,t){"ontouchstart"in document?c.style("-webkit-tap-highlight-color","transparent").on("touchmove",e).on("mouseenter",n).on("mouseleave",a):c.on("mousemove",e).on("mouseenter",n).on("mouseleave",a);var s=c.append("g").attr("display","none").style("font","10px sans-serif"),d=s.selectAll("path").data([null]).join("path").attr("fill","white").attr("stroke","black");function e(){d3.event.preventDefault();h.invert(d3.event.layerY);var t=m.invert(d3.mouse(c.node())[0]),e=d3.bisector(function(t){return t.date}).left(u,t,1),n=e-1,a=t-u[n].date>u[e].date-t?e:n,o=u[a];s.attr("transform","translate(".concat(m(o.date),",").concat(h(o[f]),")"));var r="".concat(o.date.toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric"}),"\n  ").concat(o[f]),i=s.selectAll("text").data([null]).join("text").call(function(t){return t.selectAll("tspan").data((r+"").split(/\n/)).join("tspan").attr("x",0).attr("y",function(t,e){return"".concat(1.1*e,"em")}).style("font-weight",function(t,e){return e?null:"bold"}).text(function(t){return t})}),l=i.node().getBBox();i.attr("transform","translate(".concat(-l.width/2,",").concat(15-l.y,")")),d.attr("d","M".concat(-l.width/2-10,",5H-5l5,-5l5,5H").concat(l.width/2+10,"v").concat(l.height+20,"h-").concat(l.width+20,"z"))}function n(){s.attr("display",null)}function a(){s.attr("display","none")}},o)};d3.json("../data/icmr/testing_data.json").then(function(n){var t=n.slice(1).map(function(t,e){return{date:timeParse(t.report_time),samples_tested:t.samples-n[e].samples}});plotChart(t,"#covid-19-tests-daily","samples_tested");var e=n.map(function(t,e){return{date:timeParse(t.report_time),samples_tested:t.samples}});plotChart(e,"#covid-19-tests","samples_tested")}),d3.json("../data/mohfw/national_confirmed_cases.json").then(function(t){var e=t[t.length-1];return d3.select("#confirmed_count").text(e.total_confirmed_cases),d3.select("#active_count").text(e.active_cases),d3.select("#recovered_count").text(e.cured),d3.select("#deceased_count").text(e.death),t}).then(function(t){return t.filter(function(t){return t.include_in_chart})}).then(function(t){return d3.map(t,function(t){return timeParse(t.record_time).setHours(0,0,0,0)})}).then(function(n){var t=n.values().map(function(t,e){return{date:timeParse(t.record_time),total_confirmed:t.total_confirmed_cases}});plotChart(t,"#covid-19-cases","total_confirmed");var e=n.values().slice(1).map(function(t,e){return{date:timeParse(t.record_time),total_confirmed:t.total_confirmed_cases-n.values()[e].total_confirmed_cases}});plotChart(e,"#covid-19-cases-daily","total_confirmed")});